# [Friend Requests II: Who Has the Most Friends](https://leetcode.com/problems/friend-requests-ii-who-has-the-most-friends/description/?envType=study-plan-v2&envId=top-sql-50)

### Problem Requirements:

Find the person who have the most friends and the most friends number.

The test cases are generated so that only one person has the most friends.

<details>
<summary style="font-size:1.3rem;"> <strong>Hints</strong> </summary>

<details>
      <summary>Hint#1</summary>
      <p>Being friends is bidirectional. If you accept someone's adding friend request, both you and the other person will have one more friend.</p>
</details>

<details>  
      <summary>Hint#2</summary>
      <p>  We want to find something for each person, think about grouping </p>
</details>

<details>  
      <summary>Hint#3</summary>
      <p>We can use a subquery to be our new table which we run select statments on  </p>
</details>

</details>
<details>
<summary style="font-size:1.3rem;"> <strong>Explanation</strong> </summary>

This is pertty tough problem, so we will try to break it down and make it easier to understand.

First we need to understand the problem, we need to find the person who have the most friends, what does it mean for a person to have the most friends ? it means that this person have the most friends sent requests accepted + the most friends received requests accepted, we can think about these two as two seperate queries, then union them together. But be careful, we need to union them using <code>union all</code> not <code>union</code>, because <code>union</code> will remove the duplicates, and we don't want that, we also want to be carful and give the columns the same name, so we can use <code>as</code> to give them the same name, this will allow the <code>union all</code> to work as expected.

Finaly, The easiest part, use the table, generated by the subquery, and group by the id, and order by the number of friends in descending order, and limit the result to one row.

</details>
<details>
<summary style="font-size:1.3rem"><strong> SQL Solution</strong> </summary>

```sql
select A.id, sum(A.friends_count) as num from
(select requester_id as id, count(requester_id) as friends_count from RequestAccepted
group by requester_id
union all
select accepter_id as id, count(accepter_id) as friends_count from RequestAccepted
group by accepter_id) A
group by A.id
order by num desc
limit 1
```

</details>
